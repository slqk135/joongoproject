<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.BoardMapper">


<select id="myGoods" parameterType="model.MyBoardDTO" resultType="model.MyBoardDTO">

	SELECT *
	FROM(SELECT ROWNUM AS num, A.*
	FROM(
	SELECT MEM_ID memId, BOARD_NUM boardNum, BOARD_TITLE boardTitle, BOARD_CONTENT boardContent, 
	BOARD_DATE boardDate, GOODS_PRICE goodsPrice ,GOODS_IMG goodsImg ,BOARD_CATEGORY boardCategory, BOARD_COUNT boardCount, BOARD_PAY boardPay, VISIBLE visible, GOODS_NAME goodsName, GOODS_STATE goodsState,BOARD_STATE boardState
	FROM BOARD 
	WHERE MEM_ID = #{memId} AND VISIBLE = 'Y'
    ORDER BY BOARD_NUM desc)A)
	WHERE num &gt;= #{startEndPageDTO.startRow} AND num &lt;= #{startEndPageDTO.endRow}

</select>



<select id="boardList" parameterType="string" resultType="model.BoardDTO">
	
	SELECT *
	FROM(SELECT ROWNUM as num, A.*
	FROM(
	SELECT MEM_ID memId, BOARD_NUM boardNum, BOARD_TITLE boardTitle, BOARD_CONTENT boardContent, 
	BOARD_DATE boardDate, GOODS_PRICE goodsPrice ,GOODS_IMG goodsImg ,BOARD_CATEGORY boardCategory, BOARD_COUNT boardCount, BOARD_PAY boardPay, VISIBLE visible, GOODS_NAME goodsName, GOODS_STATE goodsState, BOARD_STATE boardState
	FROM BOARD 
	WHERE BOARD_CATEGORY = #{boardCategory} AND VISIBLE = 'Y'
	ORDER BY BOARD_NUM DESC)A)
	WHERE num &gt;= #{startEndPageDTO.startRow} AND num &lt;= #{startEndPageDTO.endRow}
	

</select>

<select id="boardContent" parameterType="int" resultType="model.BoardViewDTO">

	SELECT m.MEM_ID memId,m.MEM_EMAIL memEmail,m.MEM_PHONE memPhone, b.BOARD_NUM boardNum, b.BOARD_TITLE boardTitle, b.BOARD_CONTENT boardContent, 
	b.BOARD_DATE boardDate, b.GOODS_PRICE goodsPrice ,b.GOODS_IMG goodsImg ,b.BOARD_CATEGORY boardCategory, b.BOARD_COUNT boardCount, b.BOARD_PAY boardPay , VISIBLE visible, GOODS_NAME goodsName, GOODS_STATE goodsState, BOARD_STATE boardState
	FROM BOARD b
    INNER JOIN 
    USERMEMBER m
    ON
    m.MEM_ID = b.MEM_ID
	WHERE BOARD_NUM = #{boardNum} AND VISIBLE = 'Y'

</select>

<select id="boardCount" resultType="int">

	SELECT COUNT(*) FROM BOARD
	
</select>

<insert id="boardCreateSave" parameterType="model.BoardDTO">
	INSERT INTO BOARD(MEM_ID, BOARD_NUM, BOARD_TITLE, BOARD_CONTENT, BOARD_DATE, GOODS_PRICE, GOODS_IMG, BOARD_CATEGORY, BOARD_COUNT, BOARD_PAY, VISIBLE,GOODS_NAME, GOODS_STATE, BOARD_STATE)
	VALUES(#{memId}, #{boardNum}, #{boardTitle}, #{boardContent},sysdate, #{goodsPrice}, #{goodsImg}, #{boardCategory},#{boardCount}, #{boardPay}, #{visible}, #{goodsName},#{goodsState}, #{boardState})
</insert>

<update id="bCount" parameterType="model.BoardViewDTO">
	UPDATE BOARD
	SET BOARD_COUNT = BOARD_COUNT + 1
	WHERE BOARD_NUM = #{boardNum}
</update>

<update id="BoardClear" parameterType="model.BoardDTO">
	UPDATE BOARD
	SET VISIBLE = 'N'
	WHERE BOARD_NUM = #{boardNum}
</update>


<select id="categoryMuti" parameterType="string" resultType="model.BoardDTO">

	SELECT MEM_ID memId, BOARD_NUM boardNum, BOARD_TITLE boardTitle, BOARD_CONTENT boardContent, 
	BOARD_DATE boardDate, GOODS_PRICE goodsPrice ,GOODS_IMG goodsImg ,BOARD_CATEGORY boardCategory, BOARD_COUNT boardCount, BOARD_PAY boardPay, VISIBLE visible, GOODS_NAME goodsName, GOODS_STATE goodsState, BOARD_STATE boardState
	FROM BOARD 
	WHERE BOARD_TITLE LIKE #{str} AND VISIBLE = 'Y'
	ORDER BY BOARD_NUM DESC

</select>

<select id="boardQuestion" parameterType="int" resultType="model.QuestionDTO">

	SELECT MEM_ID memId, BOARD_NUM boardNum, BOARD_QUESTION_NUM boardQuestionNum, BOARD_QUESTION_DATE boardQuestionDate, BOARD_QUESTION_CONTENT boardQuestionContent, MEM_NAME memName, STATE state
	FROM BOARD_QUESTION
	WHERE BOARD_NUM = #{boardNum} AND STATE = 'Y'
	ORDER BY BOARD_QUESTION_NUM DESC

</select>

<insert id="questionCreateSave" parameterType="model.QuestionDTO">
	INSERT INTO BOARD_QUESTION(MEM_ID, BOARD_NUM, BOARD_QUESTION_NUM, BOARD_QUESTION_DATE,BOARD_QUESTION_CONTENT, MEM_NAME, STATE)
	VALUES(#{memId},#{boardNum},#{boardQuestionNum},sysdate,#{boardQuestionContent},#{memName},'Y' )
</insert>


<select id="questionBoardNum" resultType="int">

	SELECT COUNT(*) FROM BOARD_QUESTION WHERE BOARD_NUM = #{boardNum}
	
</select>

<update id="QuestionCle" parameterType="model.QuestionDTO">
	UPDATE BOARD_QUESTION
	SET STATE = 'N'
	WHERE BOARD_QUESTION_NUM = #{boardQuestionNum}
</update>

<update id="boardMoSave" parameterType="model.BoardDTO">
	UPDATE BOARD
	SET BOARD_CATEGORY = #{boardCategory}, BOARD_CONTENT = #{boardContent} , BOARD_PAY = #{boardPay} , BOARD_TITLE = #{boardTitle} , GOODS_PRICE = #{goodsPrice}
	WHERE BOARD_NUM = #{boardNum}
</update>

<select id = "count" parameterType="string" resultType="int" >
	 SELECT count(*)
	 FROM BOARD 
	 WHERE BOARD_CATEGORY = #{category} AND VISIBLE = 'Y'
</select>

<select id = "Mycount" parameterType="string" resultType="int" >
	 SELECT count(*)
	 FROM BOARD 
	 WHERE MEM_ID = #{memId} AND VISIBLE = 'Y'
</select>

<select id = "Muticount" parameterType="string" resultType="int" >
	 SELECT count(*)
	 FROM BOARD 
	 WHERE BOARD_TITLE LIKE #{str} AND VISIBLE = 'Y'
</select>

<update id="boardState" parameterType="model.BoardDTO">
	UPDATE BOARD
	SET BOARD_STATE = 'Y'
	WHERE BOARD_NUM = #{boardNum}
</update>



</mapper>
